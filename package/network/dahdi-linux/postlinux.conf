# --- T2-COPYRIGHT-NOTE-BEGIN ---
# This copyright note is auto-generated by ./scripts/Create-CopyPatch.
# 
# T2 SDE: package/.../dahdi-linux/postlinux.conf
# Copyright (C) 2006 - 2007 The T2 SDE Project
# 
# More information can be found in the files COPYING and README.
# 
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; version 2 of the License. A copy of the
# GNU General Public License can be found in the file COPYING.
# --- T2-COPYRIGHT-NOTE-END ---

var_append makeopt " " "CC=$KCC"

var_append makeopt " " "KVERS=$lx_kernelrelease"
var_append makeopt " " "KSRC=$kerneldir"
var_append makeopt " " "INSTALL_PREFIX=$root"
var_append makeopt " " "DESTDIR=$root"
#var_append makeopt " " "HOTPLUG_FIRMWARE=no"

makeinstopt="$makeopt install-modules"
var_append makeopt " " "modules"

copy_overlay_to_dahdi() {
	cp -Rp $base/package/network/dahdi-linux/overlay/* .
}

copy_oslec_to_dahdi() {
	mkdir drivers/staging/
	mkdir drivers/staging/echo
	cp $base/package/network/dahdi-linux/oslec/* drivers/staging/echo/
}

copy_target_kbuild_to_dahdi() {
	cp $base/target/$target/dahdi.kbuild drivers/dahdi/Kbuild
}

copy_pika_warp_dsp_header() {
	cp $base/package/network/dahdi-linux/overlay/drivers/dahdi/pika_warp_dsp_driver/warp-dsp.h \
	 ./drivers/dahdi/pika_warp_dahdi_transcoder/
	cp $base/package/network/dahdi-linux/overlay/drivers/dahdi/pika_warp_dsp_driver/warp-dsp.h \
	 ./drivers/dahdi/pika_warp_dahdi_echocan/
	cp $base/package/network/dahdi-linux/overlay/drivers/dahdi/pika_warp_dsp_driver/3rdparty/* \
	./drivers/dahdi/pika_warp_dsp_driver/
	cp $base/package/network/dahdi-linux/overlay/drivers/dahdi/pika_warp_dsp_driver/warp-dsp.h \
	 ./drivers/dahdi/pika_warp_dsp_driver/3rdparty/
}

hook_add premake 4 copy_overlay_to_dahdi

if [ "$target" = pbx-pikawarp ]; then
	hook_add premake 4 copy_pika_warp_dsp_header
fi

hook_add premake 5 copy_oslec_to_dahdi
hook_add premake 6 copy_target_kbuild_to_dahdi
